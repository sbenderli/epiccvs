<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Historic Resumes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Markdown renderer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    console.log("✅ marked version:", marked.version);
  </script>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --ink: #e5e7eb;
      --ink-dim: #9ca3af;
      --accent: #60a5fa;
      --border: #1f2937;
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      display: grid;
      grid-template-columns: 280px 1fr;
      grid-template-rows: 56px 1fr;
      grid-template-areas:
        "header header"
        "sidebar main";
    }
    header {
      grid-area: header;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
    }
    header h1 {
      font-size: 18px;
      margin: 0;
      font-weight: 600;
      letter-spacing: 0.2px;
    }
    #search {
      width: 260px;
      max-width: 40vw;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #0b1220;
      color: var(--ink);
      outline: none;
    }
    aside {
      grid-area: sidebar;
      border-right: 1px solid var(--border);
      background: #0b1220;
      overflow: auto;
    }
    .list {
      padding: 8px;
      display: grid;
      gap: 6px;
    }
    .item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #0a0f1a;
      color: var(--ink);
      cursor: pointer;
      text-decoration: none;
      transition: transform .03s ease-in;
    }
    .item:hover { transform: translateY(-1px); border-color: #263244 }
    .item.active { border-color: var(--accent); box-shadow: 0 0 0 1px rgba(96,165,250,.35) inset }
    .item .title { font-weight: 600; font-size: 14px }
    .item .sub { font-size: 12px; color: var(--ink-dim) }
    main {
      grid-area: main;
      overflow: auto;
      padding: 24px;
    }
    .doc {
      max-width: 900px;
      margin: 0 auto;
      background: #0a0f1a;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 28px 28px 56px;
      line-height: 1.6;
    }
    .doc h1, .doc h2, .doc h3 { color: #f3f4f6 }
    .doc h1 { font-size: 28px; margin-top: 0 }
    .doc h2 { font-size: 20px; margin-top: 28px }
    .doc h3 { font-size: 16px; margin-top: 22px }
    .doc a { color: var(--accent); text-decoration: none }
    .doc a:hover { text-decoration: underline }
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 12px;
      margin-bottom: 18px;
    }
    .btn {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #0b1424;
      color: var(--ink);
      text-decoration: none;
      font-size: 14px;
    }
    .muted { color: var(--ink-dim); font-size: 12px }
    @media (max-width: 900px) {
      body {
        grid-template-columns: 1fr;
        grid-template-rows: 56px auto 1fr;
        grid-template-areas:
          "header"
          "sidebar"
          "main";
      }
      aside { max-height: 40vh }
      #search { width: 45vw }
    }
  </style>
</head>
<body>
  <header>
    <h1>Historic Resumes</h1>
    <input id="search" type="search" placeholder="Filter list" aria-label="Filter resumes" />
  </header>

  <aside>
    <div class="list" id="list"></div>
  </aside>

  <main>
    <div class="doc">
      <div class="toolbar">
        <div id="meta" class="muted">Select a resume</div>
        <div>
          <a id="viewRaw" class="btn" href="#" target="_blank" rel="noopener">View raw MD</a>
        </div>
      </div>
      <article id="content">Pick from the left to render Markdown here.</article>
    </div>
  </main>

  <script>
    // Configure your resumes here
    const RESUMES = [
      {
        id: "ibrahim-pasa",
        title: "İbrahim Paşa",
        role: "Grand Vizier",
        md: "./resumes/ibrahim-pasa.md",
      },
      {
        id: "gavrilo-princip",
        title: "Gavrilo Princip",
        role: "Political Activist",
        md: "./resumes/gavrilo-princip.md",
      },
      {
        id: "joseph-goebbels",
        title: "Joseph Goebbels",
        role: "Propaganda Executive",
        md: "./resumes/joseph-goebbels.md",
      }
    ];

    const $list = document.getElementById("list");
    const $content = document.getElementById("content");
    const $meta = document.getElementById("meta");
    const $search = document.getElementById("search");
    const $viewRaw = document.getElementById("viewRaw");

    function renderList(filter = "") {
      $list.innerHTML = "";
      const q = filter.trim().toLowerCase();
      const items = RESUMES.filter(r =>
        !q || r.title.toLowerCase().includes(q) || r.role.toLowerCase().includes(q)
      );
      for (const r of items) {
        const a = document.createElement("a");
        a.className = "item";
        a.href = `#${r.id}`;
        a.innerHTML = `
          <div>
            <div class="title">${r.title}</div>
            <div class="sub">${r.role}</div>
          </div>
        `;
        $list.appendChild(a);
      }
      markActive();
      if (items.length === 0) {
        $list.innerHTML = `<div class="muted" style="padding:10px">No matches</div>`;
      }
    }

    function markActive() {
      const id = location.hash.replace("#", "");
      Array.from($list.children).forEach(el => {
        el.classList.toggle("active", el.getAttribute("href") === `#${id}`);
      });
    }

    async function loadManifest() {
      const res = await fetch("./resumes.json", { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    (async () => {
      try {
        const items = await loadManifest(); // comes from resumes.json
        const list = document.getElementById("list");
        const content = document.getElementById("content");
        const meta = document.getElementById("meta");

        // render sidebar
        list.innerHTML = items.map(r => `
          <a class="item" href="#${r.id}" data-md="${r.md}">
            <div class="title">${r.title}</div>
            <div class="sub">${r.role}</div>
          </a>`).join("");

        // lookup table
        const byId = Object.fromEntries(items.map(r => [r.id, r]));

        async function pick(id) {
          const r = byId[id] || items[0];
          meta.textContent = `${r.title} • ${r.role}`;
          [...list.children].forEach(el =>
            el.classList.toggle("active", el.getAttribute("href") === "#" + r.id)
          );

          try {
            const res = await fetch(r.md, { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status} ${r.md}`);
            const md = await res.text();
            marked.setOptions({ mangle: true, headerIds: true });
            content.innerHTML = marked.parse(md);
          } catch (e) {
            console.error(e);
            content.innerHTML =
              `<p class="muted">Could not load Markdown.<br>${e.message}</p>`;
          }
        }

        // hook up hash navigation
        window.addEventListener("hashchange", () =>
          pick(location.hash.slice(1))
        );

        // initial load
        if (location.hash) {
          pick(location.hash.slice(1));
        } else if (items.length) {
          location.hash = "#" + items[0].id;
        }

      } catch (e) {
        console.error("Manifest load failed:", e);
        document.getElementById("content").innerHTML =
          `<p class="muted">Failed to load manifest.<br>${e.message}</p>`;
      }
    })();

    window.addEventListener("hashchange", () => {
      const id = location.hash.replace("#", "");
      load(id);
    });

    $search.addEventListener("input", e => renderList(e.target.value));

    // Init
    renderList();
    if (location.hash) {
      load(location.hash.replace("#", ""));
    } else if (RESUMES.length) {
      location.hash = `#${RESUMES[0].id}`;
    }
  </script>
</body>
</html>
